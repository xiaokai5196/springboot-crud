<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dict.emp.mapper.EmpMapper">
  <!--开启二级缓存-->
  <cache></cache>
  <resultMap id="BaseResultMap" type="com.dict.emp.entity.Emp">
    <id column="empno" jdbcType="INTEGER" property="empno" />
    <result column="ename" jdbcType="VARCHAR" property="ename" />
    <result column="job" jdbcType="VARCHAR" property="job" />
    <result column="mgr" jdbcType="INTEGER" property="mgr" />
    <result column="hiredate" jdbcType="DATE" property="hiredate" />
    <result column="sal" jdbcType="REAL" property="sal" />
    <result column="comm" jdbcType="REAL" property="comm" />
    <result column="deptno" jdbcType="INTEGER" property="deptno" />
  </resultMap>

  <sql id="Base_Column_List">
    empno, ename, job, mgr, hiredate, sal, comm, deptno
  </sql>

  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from emp
    where empno = #{empno,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from emp
    where empno = #{empno,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.dict.emp.entity.Emp">
    insert into emp (empno, ename, job, 
      mgr, hiredate, sal, comm, 
      deptno)
    values (#{empno,jdbcType=INTEGER}, #{ename,jdbcType=VARCHAR}, #{job,jdbcType=VARCHAR}, 
      #{mgr,jdbcType=INTEGER}, #{hiredate,jdbcType=DATE}, #{sal,jdbcType=REAL}, #{comm,jdbcType=REAL}, 
      #{deptno,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.dict.emp.entity.Emp">
    insert into emp
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        empno,
      </if>
      <if test="ename != null">
        ename,
      </if>
      <if test="job != null">
        job,
      </if>
      <if test="mgr != null">
        mgr,
      </if>
      <if test="hiredate != null">
        hiredate,
      </if>
      <if test="sal != null">
        sal,
      </if>
      <if test="comm != null">
        comm,
      </if>
      <if test="deptno != null">
        deptno,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        #{empno,jdbcType=INTEGER},
      </if>
      <if test="ename != null">
        #{ename,jdbcType=VARCHAR},
      </if>
      <if test="job != null">
        #{job,jdbcType=VARCHAR},
      </if>
      <if test="mgr != null">
        #{mgr,jdbcType=INTEGER},
      </if>
      <if test="hiredate != null">
        #{hiredate,jdbcType=DATE},
      </if>
      <if test="sal != null">
        #{sal,jdbcType=REAL},
      </if>
      <if test="comm != null">
        #{comm,jdbcType=REAL},
      </if>
      <if test="deptno != null">
        #{deptno,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.dict.emp.entity.Emp">
    update emp
    <set>
      <if test="ename != null">
        ename = #{ename,jdbcType=VARCHAR},
      </if>
      <if test="job != null">
        job = #{job,jdbcType=VARCHAR},
      </if>
      <if test="mgr != null">
        mgr = #{mgr,jdbcType=INTEGER},
      </if>
      <if test="hiredate != null">
        hiredate = #{hiredate,jdbcType=DATE},
      </if>
      <if test="sal != null">
        sal = #{sal,jdbcType=REAL},
      </if>
      <if test="comm != null">
        comm = #{comm,jdbcType=REAL},
      </if>
      <if test="deptno != null">
        deptno = #{deptno,jdbcType=INTEGER},
      </if>
    </set>
    where empno = #{empno,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.dict.emp.entity.Emp">
    update emp
    set ename = #{ename,jdbcType=VARCHAR},
      job = #{job,jdbcType=VARCHAR},
      mgr = #{mgr,jdbcType=INTEGER},
      hiredate = #{hiredate,jdbcType=DATE},
      sal = #{sal,jdbcType=REAL},
      comm = #{comm,jdbcType=REAL},
      deptno = #{deptno,jdbcType=INTEGER}
    where empno = #{empno,jdbcType=INTEGER}
  </update>

  <select id="selectEmpList" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from emp
  </select>

  <select id="selectAllByPageCondition" parameterType="java.util.Map" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from emp
    <where>
      <if test="ename != null">
        ename like CONCAT(CONCAT('%', #{ename}), '%')
      </if>
      <if test="deptno != null">
        and deptno = #{deptno}
      </if>
    </where>
  </select>

  <insert id="insertBatch" parameterType="java.util.List">
    insert into emp (empno, ename, job,
        mgr, hiredate, sal, comm,
        deptno)
    values
    <foreach collection="empList" item="emp" separator=",">
      <trim prefix="(" suffix=")" suffixOverrides=",">
        #{emp.empno},
        #{emp.ename},
        #{emp.job},
        #{emp.mgr},
        #{emp.hiredate},
        #{emp.sal},
        #{emp.comm},
        #{emp.deptno},
      </trim>
    </foreach>
  </insert>

  <delete id="deleteBatch" parameterType="java.util.List">
    delete from emp
    where empno in
    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </delete>

  <resultMap id="EmpinfoResultMap" type="com.dict.emp.entity.vo.EmpInfo">
    <id column="empno" jdbcType="INTEGER" property="empno" />
    <result column="ename" jdbcType="VARCHAR" property="ename" />
    <result column="job" jdbcType="VARCHAR" property="job" />
    <result column="mgr" jdbcType="INTEGER" property="mgr" />
    <result column="hiredate" jdbcType="DATE" property="hiredate" />
    <result column="sal" jdbcType="REAL" property="sal" />
    <result column="comm" jdbcType="REAL" property="comm" />
    <association property="dept" javaType="com.dict.emp.entity.Dept">
      <id column="deptno" jdbcType="INTEGER" property="deptno" />
      <result column="dname" jdbcType="VARCHAR" property="dname" />
      <result column="loc" jdbcType="VARCHAR" property="loc" />
    </association>
  </resultMap>
  <select id="selectEmpInfoById" resultMap="EmpinfoResultMap">
    select
       e.empno,e.empno, e.ename, e.job, e.mgr, e.hiredate, e.sal, e.comm, e.deptno,
       d.deptno, d.dname, d.loc
    from emp e left join dept d on e.deptno = d.deptno
    where e.empno = #{empno};
  </select>

  <resultMap id="EmpinfoStepResultMap" type="com.dict.emp.entity.vo.EmpInfo">
    <id column="empno" jdbcType="INTEGER" property="empno" />
    <result column="ename" jdbcType="VARCHAR" property="ename" />
    <result column="job" jdbcType="VARCHAR" property="job" />
    <result column="mgr" jdbcType="INTEGER" property="mgr" />
    <result column="hiredate" jdbcType="DATE" property="hiredate" />
    <result column="sal" jdbcType="REAL" property="sal" />
    <result column="comm" jdbcType="REAL" property="comm" />
    <association property="dept" column="deptno" select="com.dict.emp.mapper.DeptMapper.selectByPrimaryKey">
    </association>
  </resultMap>
  <select id="selectEmpInfoByIdStep" resultMap="EmpinfoStepResultMap">
    select * from emp where empno = #{empno}
  </select>


  <resultMap id="DeptInfoResultMap" type="com.dict.emp.entity.vo.DeptInfo">
    <id column="deptno" jdbcType="INTEGER" property="deptno" />
    <result column="dname" jdbcType="VARCHAR" property="dname" />
    <result column="loc" jdbcType="VARCHAR" property="loc" />
    <collection property="empList" ofType="java.util.List" resultMap="BaseResultMap">
    </collection>
  </resultMap>
  <select id="selectDeptInfoList" resultMap="DeptInfoResultMap">
    select d.*, e.*
    from dept d left join emp e on d.deptno = e.deptno
    <where>
      <if test="deptno != null">
        d.deptno = #{deptno}
      </if>
    </where>
  </select>

  <resultMap id="DeptInfoStepResultMap" type="com.dict.emp.entity.vo.DeptInfo">
    <id column="deptno" jdbcType="INTEGER" property="deptno" />
    <result column="dname" jdbcType="VARCHAR" property="dname" />
    <result column="loc" jdbcType="VARCHAR" property="loc" />
    <collection property="empList" column="deptno" select="selectEmpListByDeptno" >
    </collection>
  </resultMap>
  <select id="selectDeptInfoListStep" resultMap="DeptInfoStepResultMap">
    select * from dept where deptno = #{deptno}
  </select>

  <select id="selectEmpListByDeptno" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from emp
    where deptno = #{deptno}
  </select>

  <select id="selectDeptCount" parameterType="java.lang.Integer" resultType="java.util.Map">
    select
    d.deptno, d.dname, d.loc,
    count(*) "total",
    round(avg(sal + ifnull(comm, 0)),2) "salary"
    from emp e left join dept d on e.deptno = d.deptno
    <where>
      <if test="deptno != null">
        e.deptno = #{deptno}
      </if>
    </where>
    group by e.deptno
    order by e.deptno
  </select>

  <insert id="insertOrUpdate" parameterType="emp">
    insert into emp
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        empno,
      </if>
      <if test="ename != null">
        ename,
      </if>
      <if test="job != null">
        job,
      </if>
      <if test="mgr != null">
        mgr,
      </if>
      <if test="hiredate != null">
        hiredate,
      </if>
      <if test="sal != null">
        sal,
      </if>
      <if test="comm != null">
        comm,
      </if>
      <if test="deptno != null">
        deptno,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        #{empno},
      </if>
      <if test="ename != null">
        #{ename},
      </if>
      <if test="job != null">
        #{job},
      </if>
      <if test="mgr != null">
        #{mgr},
      </if>
      <if test="hiredate != null">
        #{hiredate},
      </if>
      <if test="sal != null">
        #{sal},
      </if>
      <if test="comm != null">
        #{comm},
      </if>
      <if test="deptno != null">
        #{deptno},
      </if>
    </trim>
    on duplicate key update
    <trim suffixOverrides=",">
      <if test="ename != null">
        ename = #{ename},
      </if>
      <if test="job != null">
        job = #{job},
      </if>
      <if test="mgr != null">
        mgr = #{mgr},
      </if>
      <if test="hiredate != null">
        hiredate = #{hiredate},
      </if>
      <if test="sal != null">
        sal = #{sal},
      </if>
      <if test="comm != null">
        comm = #{comm},
      </if>
      <if test="deptno != null">
        deptno = #{deptno},
      </if>
    </trim>
  </insert>

  <insert id="insertByJob" parameterType="emp">
    insert into emp
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        empno,
      </if>
      <if test="ename != null">
        ename,
      </if>
      <if test="job != null">
        job,
      </if>
      <if test="mgr != null">
        mgr,
      </if>
      <if test="hiredate != null">
        hiredate,
      </if>
      <if test="sal != null">
        sal,
      </if>
      comm,
      <if test="deptno != null">
        deptno,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="empno != null">
        #{empno},
      </if>
      <if test="ename != null">
        #{ename},
      </if>
      <if test="job != null">
        #{job},
      </if>
      <if test="mgr != null">
        #{mgr},
      </if>
      <if test="hiredate != null">
        #{hiredate},
      </if>
      <if test="sal != null">
        #{sal},
      </if>
      <choose>
        <when test="job == 'SALESMAN'">
          1000,
        </when>
        <otherwise>
          null,
        </otherwise>
      </choose>
      <if test="deptno != null">
        #{deptno},
      </if>
    </trim>
  </insert>


  <resultMap id="empDetailResultMap" type="com.dict.emp.entity.vo.EmpDetail">
    <id column="empno" jdbcType="INTEGER" property="empno"/>
    <result column="ename" jdbcType="VARCHAR" property="ename"/>
    <result column="job" jdbcType="VARCHAR" property="job"/>
    <result column="mgr" jdbcType="INTEGER" property="mgr"/>
    <result column="hiredate" jdbcType="DATE" property="hiredate"/>
    <result column="sal" jdbcType="REAL" property="sal"/>
    <result column="comm" jdbcType="REAL" property="comm"/>
    <association property="dept" javaType="com.dict.emp.entity.Dept">
      <id column="deptno" jdbcType="INTEGER" property="deptno" />
      <result column="dname" jdbcType="VARCHAR" property="dname" />
      <result column="loc" jdbcType="VARCHAR" property="loc" />
    </association>
    <association property="salgrade" javaType="com.dict.emp.entity.Salgrade">
      <id column="grade" jdbcType="INTEGER" property="grade" />
      <result column="losal" jdbcType="INTEGER" property="losal" />
      <result column="hisal" jdbcType="INTEGER" property="hisal" />
    </association>
  </resultMap>
  <select id="selectDetailByIdName" parameterType="com.dict.emp.entity.Emp" resultMap="empDetailResultMap">
    select
    e.empno, e.ename, e.job, e.mgr, e.hiredate, e.sal, e.comm,
    d.deptno, d.dname, d.loc,
    s.grade, s.losal, s.hisal
    from emp e
    left join dept d on e.deptno = d.deptno
    left join salgrade s on e.sal between s.losal and s.hisal
    where
    <choose>
      <when test="empno != null">
        empno = #{empno}
      </when>
      <when test="ename != null">
        ename = #{ename}
      </when>
    </choose>
  </select>





</mapper>